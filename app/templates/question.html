<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello Bulma!</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bulma.min.css') }}">

    <script defer src="{{ url_for('static', filename='components/VotingButtons.js') }}">

    </script>
  </head>
  <body>
  <section class="section">
    <header class="container">
      <hgroup>
      <h1 class="title is-1">
        Hello World
      </h1>
      <p class="subtitle">
        My first website with <strong>Bulma</strong>!
      </p>
      </hgroup>
    </header>
  </section>
  <section class="section">
    <div class="container">
      <a href="{{ url_for('index') }}" class="button is-link is-light">Retour</a>
    </div>
    <div class="container block">
      <h2 class="title is-2">{{ question.title }}</h2>
      <div class="columns ">
        <aside class="column ">
          <voting-buttons data-message-id="{{ question.id }}" data-uservote="0"
            data-upvote-url="{{ url_for('upvote') }}" data-downvote-url="{{ url_for('downvote') }}"
            data-nullify-url="{{ url_for('nullify_vote') }}"
          ></voting-buttons>
        </aside>
        <div class="column is-full">
          <p class="content">{{ question.text }}</p>
          {% for tag in tags %}
          <a class="tag" href="{{ url_for('tagged_questions', tag=tag) }}">{{ tag }}</a>
          {% endfor %}
          <footer>
            <small>
              <p>Demandé le {{ question.create_date }}</p>
              <p><strong>{{ question.firstname }} {{ question.lastname }}</strong></p>
            </small>
          </footer>
        </div>
      </div>
    </div>
  </section>
  <section class="section">
    <div class="container">
      <h3 class="title is-3">Réponses</h3>
      {% for answer in answers %}
        <article class="box">
          <div class="columns">
            <aside class="column">
              <voting-buttons data-message-id="{{ answer.message_id }}" data-uservote="0"
                data-upvote-url="{{ url_for('upvote') }}" data-downvote-url="{{ url_for('downvote') }}"
                data-nullify-url="{{ url_for('nullify_vote') }}"
              ></voting-buttons>
            </aside>
            <div class="column is-full">
              <p class="content">{{ answer.text }}</p>
              <footer>
                <small>
                  <p>Répondu le {{ answer.create_date }}</p>
                  <p><strong>{{ answer.firstname }} {{ answer.lastname }}</strong></p>
                </small>
              </footer>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>
  </section>
  <section class="section">
    <div class="container">
      <form method="post">
        <div class="field">
          <label for="answer" class="label title is-3">Votre réponse</label>
          <div class="control">
            <textarea id="answer" class="textarea" name="answer"></textarea>
          </div>
        </div>
        <input class="button is-link" type="submit" value="Envoyer">
      </form>
    </div>
  </section>
  <script>


    // const doUpvote = async (e) => {
    //   // e.target.classList.add('is-link');
    //   const messageId = e.target.attributes['data-id'].value;
    //   const url = "{{ url_for('upvote') }}";
    //   const response = await postData(url, { messageId: messageId });
    // }

    // const removeVote = async (e) => {
    //   // e.target.classList.remove('is-link');
    //   const messageId = e.target.attributes['data-id'].value;
    //   const url = "{{ url_for('nullify_vote') }}";
    //   const response = await postData(url, { messageId: messageId });
    // }

    // const upvote = async (e) => {
    //   const messageId = e.target.attributes['data-id'].value;
    //   const voteLabel = document.querySelector(`span[data-id="${messageId}"]`);
    //   if (isDownvoted) {
    //     isDownvoted = false;
    //     voteLabel.innerText = Number(voteLabel.innerText) + 1;
    //   }
    //   if (!isUpvoted) {
    //     await doUpvote(e);
    //     isUpvoted = true;
    //     voteLabel.innerText = Number(voteLabel.innerText) + 1;
    //     return;
    //   } 
    //   await removeVote(e);
    //   isUpvoted = false;
    //   voteLabel.innerText = Number(voteLabel.innerText) - 1;
    //   return;
    // }
 


    // const doDownvote = async (e) => {
    //   const messageId = e.target.attributes['data-id'].value;
    //   // e.target.classList.add('is-link');
    //   const url = "{{ url_for('downvote') }}";
    //   const response = await postData(url, { messageId: messageId });
    // };

    // const downvote = async (e) => {
    //   const messageId = e.target.attributes['data-id'].value;
    //   const voteLabel = document.querySelector(`span[data-id="${messageId}"]`);
    //   if (isUpvoted) {
    //     isUpvoted = false;
    //     voteLabel.innerText = Number(voteLabel.innerText) - 1;
    //   }
    //   if (!isDownvoted) {
    //     await doDownvote(e);
    //     isDownvoted = true;
    //     voteLabel.innerText = Number(voteLabel.innerText) - 1;
    //     return;
    //   } 
    //   await removeVote(e);
    //   isDownvoted = false;
    //   voteLabel.innerText = Number(voteLabel.innerText) + 1;
    //   return;
    // };

    // for (upvoteButton of upvoteButtons) {
    //   upvoteButton.onclick = upvote;
    // }
    // for (downvoteButton of downvoteButtons) {
    //   downvoteButton.onclick = downvote;
    // }

  </script>
  </body>
</html>
